#!/bin/bash

# Stop Nginx if it's already running
service nginx stop

# Backup the default Nginx configuration
cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak

# Replace the user directive in the Nginx configuration with "nginx"
sed -i 's/user\s*[^;]*/user nginx;/' /etc/nginx/nginx.conf

# Ensure Nginx is listening on all active IPs on port 8080
sed -i 's/listen\s*[^;]*;/listen 8080;/g' /etc/nginx/nginx.conf

# Start Nginx
service nginx start

# Verify that Nginx is running as the nginx user
ps aux | grep 'nginx'

# Verify that Nginx is listening on port 8080
nc -z 0 8080

# Exit with success status
exit 0

